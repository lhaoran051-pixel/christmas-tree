<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Merry Christmas</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background:
        radial-gradient(circle at 20% -10%, #3c4fa3 0, transparent 55%),
        radial-gradient(circle at 80% -20%, #f5a8ff 0, transparent 60%),
        #02071c;
      overflow: hidden;
      font-family: "Segoe UI", system-ui, sans-serif;
    }

    /* æš—è§’ï¼Œèšå…‰ç¯æ•ˆæœ */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(circle at 50% 35%, transparent 0, transparent 45%, rgba(0,0,0,0.55) 100%);
      z-index: 0;
    }

    canvas {
      display: block;
    }

    .text {
      position: fixed;
      left: 50%;
      top: 16%;
      transform: translateX(-50%);
      color: #fff;
      font-size: 42px;
      letter-spacing: 4px;
      text-shadow: 0 0 15px rgba(255, 200, 230, 0.9);
      pointer-events: none;
      z-index: 2;
      opacity: 0;
      animation: titleIn 1.2s ease-out forwards 0.8s; /* æ–‡å­—å‡ºç°æ—¶é—´/å»¶è¿Ÿåœ¨è¿™é‡Œè°ƒ */
    }

    @keyframes titleIn {
      0% {
        opacity: 0;
        transform: translateX(-50%);
      }
      60% {
        opacity: 1;
        transform: translateX(-50%);
      }
      100% {
        opacity: 1;
        transform: translateX(-50%);
        letter-spacing: 4px;
      }
    }

    /* é¡¶éƒ¨æ˜Ÿæ˜Ÿ */
    .star {
      position: fixed;
      left: 50%;
      top: 30%;
      transform: translate(-50%, -50%) scale(0.2);
      opacity: 0;
      pointer-events: none;
      z-index: 3;
      animation: starFadeIn 3s ease-out 4s forwards; /* æ˜Ÿæ˜Ÿå‡ ç‚¹å‡ºç°ã€å¤šä¹…æ·¡å…¥ */
    }

    .star svg {
      width: 110px;
      height: 110px;
      filter:
        drop-shadow(0 0 8px rgba(255, 215, 0, 1))
        drop-shadow(0 0 18px rgba(255, 215, 0, 0.8))
        drop-shadow(0 0 35px rgba(255, 255, 160, 0.7));
      animation: starGlow 2.6s ease-in-out infinite; /* æ˜Ÿæ˜Ÿå‘¼å¸å…‰çš„é€Ÿåº¦ */
    }

    @keyframes starGlow {
      0%, 100% {
        transform: scale(1);
        filter:
          drop-shadow(0 0 8px rgba(255, 215, 0, 0.9))
          drop-shadow(0 0 18px rgba(255, 215, 0, 0.7))
          drop-shadow(0 0 35px rgba(255, 255, 160, 0.6));
      }
      50% {
        transform: scale(1.07);
        filter:
          drop-shadow(0 0 12px rgba(255, 240, 180, 1))
          drop-shadow(0 0 30px rgba(255, 240, 180, 0.95))
          drop-shadow(0 0 55px rgba(255, 255, 200, 0.9));
      }
    }

    @keyframes starFadeIn {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.2);
      }
      60% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.1);
      }
      100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    .hint-bubble {
      position: fixed;
      right: 28px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.12);
      padding: 12px 20px;
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      letter-spacing: 1px;
      backdrop-filter: blur(6px);
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.4);
      z-index: 50;
      cursor: pointer;
      opacity: 0;
      animation: hintFadeIn 1.5s ease forwards 0.3s; /* æç¤ºæ¡†å‡ºç°æ—¶é—´å’Œå»¶è¿Ÿ */
    }

    @keyframes hintFadeIn {
      from { opacity: 0; transform: translateY(-50%) translateX(15px); }
      to   { opacity: 1; transform: translateY(-50%) translateX(0); }
    }

    @keyframes hintPulse {
      0%, 100% { box-shadow: 0 0 10px rgba(255,255,255,0.3); }
      50% { box-shadow: 0 0 25px rgba(255,255,255,0.7); }
    }

    .hint-bubble.pulse {
      animation: hintPulse 1.8s infinite;
    }
  </style>
</head>
<body>

  <audio id="bgm" src="exo.mp3" loop autoplay muted></audio>

  <div class="text">Merry Christmas</div>

  <div class="star">
    <svg width="120" height="120" viewBox="0 0 1024 1024">
      <path fill="rgba(255,215,0,0.6)"
            d="M512 60l140 284 314 46-227 221 54 314-281-148-281 148 54-314L58 390l314-46z"/>
    </svg>
  </div>

  <div class="hint-bubble" id="hint">
    ç‚¹å‡»ä¸€ä¸‹é¡µé¢æœ‰æƒŠå–œ ğŸ
  </div>

  <canvas id="c"></canvas>

  <script>
    // ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼šæ”¹æç¤ºæ–‡å­— + æ’­æ”¾éŸ³ä¹
    window.addEventListener("click", () => {
      const hint = document.getElementById("hint");
      if (!hint) return;

      hint.textContent = "æ¨æœˆç‘¶åœ£è¯å¿«ä¹ ğŸ„";
      hint.style.transition = "all 0.8s ease";        // æç¤ºæ¡†åŠ¨ç”»é€Ÿåº¦
      hint.style.right = "28px";
      hint.style.top = "50%";
      hint.style.transform = "translateY(-50%) scale(1.3)";
      hint.style.fontSize = "24px";                  // æ–‡å­—å¤§å°
      hint.style.padding = "18px 26px";

      hint.style.background = "rgba(255, 215, 0, 0.25)";
      hint.style.boxShadow = "0 0 35px rgba(255, 230, 160, 0.9)";
      hint.classList.remove("pulse");

      const bgm = document.getElementById("bgm");
      bgm.muted = false;
      bgm.volume = 1.0;                               // èƒŒæ™¯éŸ³ä¹éŸ³é‡ï¼ˆ0~1ï¼‰
      bgm.play().catch(err => console.log("Chrome autoplay blocked:", err));
    }, { once: true });

    const canvas = document.getElementById("c");
    const ctx = canvas.getContext("2d");

    // åŸºæœ¬å‚æ•°
    const particles = [];
    const TREE_COUNT = 8000;   // æ ‘ä¸Šç²’å­æ•°é‡
    const RING_COUNT = 5000;   // åœ°é¢å…‰ç‚¹æ•°é‡
    const SKY_COUNT  = 600;    // æ˜Ÿç©ºç²’å­æ•°é‡
    const TREE_HEIGHT = 360;   // æ ‘çš„é«˜åº¦
    const BASE_RADIUS = 220;   // æ ‘åº•åŠå¾„

    // é›ªèŠ±ç›¸å…³
    const SNOW_COUNT = 10000;  // é›ªèŠ±æ•°é‡
    const snows = [];

    const center = { x: canvas.width / 2, y: canvas.height * 0.80 };
    let angle = 0;
    let globalProgress = 0;    // æ§åˆ¶æ ‘ä»ä¸‹å¾€ä¸Šâ€œé•¿å‡ºæ¥â€çš„è¿›åº¦
    let ribbonAppear = 0;      // æ§åˆ¶å½©å¸¦å‡ºç°çš„æ—¶é—´

    // ç›¸æœºï¼ˆæ ‘æ—‹è½¬ + é¼ æ ‡ä¸Šä¸‹æ§åˆ¶ä¿¯ä»°ï¼‰
    let baseAngle = 0;         // æ ‘è‡ªåŠ¨æ—‹è½¬é€Ÿåº¦
    let cameraTilt = 0;        // å½“å‰ä¿¯ä»°è§’
    let cameraTiltTarget = 0;  // é¼ æ ‡ç›®æ ‡ä¿¯ä»°è§’

    // å·¥å…·å‡½æ•°
    function rand(min, max) {
      return Math.random() * (max - min) + min;
    }

    function easeOutCubic(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    function angleDiff(a, b) {
      let d = a - b;
      d = (d + Math.PI) % (Math.PI * 2) - Math.PI;
      return Math.abs(d);
    }

    // å½©å¸¦é…ç½®
    const spiralConfigs = [
      { turns: 6.0, phase: 0.0,  width: 1.0, color: { r:255, g:255, b:120 } },
      { turns: 8.0, phase: 3.14, width: 1.0, color: { r:120, g:255, b:180 } },
    ];

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      center.x = canvas.width / 2;
      center.y = canvas.height * 0.80;
      createSnow();
    }
    window.addEventListener("resize", resize);
    resize();

    // é¼ æ ‡ä¸Šä¸‹æ§åˆ¶è§†è§’
    window.addEventListener("mousemove", (e) => {
      const ny = (e.clientY / window.innerHeight) - 0.5; // -0.5 ~ 0.5
      cameraTiltTarget = ny * 0.25;                      // 0.25 å¯ä»¥æ”¹å¤§å°ï¼Œæ§åˆ¶ä»°è§†å¹…åº¦
    });

    // åˆå§‹åŒ–æ ‘ + åœ°é¢ + æ˜Ÿç©º
    function createScene() {
      particles.length = 0;

      // æ ‘èº«
      for (let i = 0; i < TREE_COUNT; i++) {
        const h = Math.random() ** 6;
        const theta = Math.random() * Math.PI * 2;

        const radius = (1 - h) * BASE_RADIUS + rand(-8, 8);
        const tx = Math.cos(theta) * radius;
        const tz = Math.sin(theta) * radius;
        const ty = h * TREE_HEIGHT + rand(-6, 6);

        const r0 = rand(260, 420);
        const t0 = Math.random() * Math.PI * 2;
        const sx = Math.cos(t0) * r0;
        const sz = Math.sin(t0) * r0;
        const sy = 500 + rand(-10, 40);

        const level = ty / TREE_HEIGHT;
        const delay = level * 0.6;   // ä¸åŒé«˜åº¦çš„ç²’å­å»¶è¿Ÿï¼ˆæ ‘ä»ä¸‹å¾€ä¸Šé•¿ï¼‰
        const duration = 0.4;

        let ribbonLayer = -1;
        for (let j = 0; j < spiralConfigs.length; j++) {
          const cfg = spiralConfigs[j];
          const ts = h * cfg.turns * Math.PI * 2 + cfg.phase;
          if (angleDiff(theta, ts) < cfg.width && Math.random() < 0.25) {
            ribbonLayer = j;
            break;
          }
        }

        particles.push({
          type: "tree",
          sx, sy, sz,
          tx, ty, tz,
          delay, duration,
          size: rand(1.3, 2.3),
          baseColor: {
            r: 255,
            g: 140 + Math.random() * 90,
            b: 200 + Math.random() * 55
          },
          twinkleOffset: Math.random() * 10,
          h,
          theta,
          ribbonLayer
        });
      }

      // åœ°é¢
      for (let i = 0; i < RING_COUNT; i++) {
        const r = rand(260, 420);
        const t = Math.random() * Math.PI * 2;
        particles.push({
          type: "ring",
          x: Math.cos(t) * r,
          z: Math.sin(t) * r,
          y: 520 + rand(-18, 18),
          size: rand(1, 1.8),
          color: { r: 255, g: 255, b: 255 },
          twinkleOffset: Math.random() * 10
        });
      }

      // æ˜Ÿç©º
      for (let i = 0; i < SKY_COUNT; i++) {
        const r = rand(600, 1200);
        const t = Math.random() * Math.PI * 2;
        particles.push({
          type: "sky",
          x: Math.cos(t) * r,
          z: Math.sin(t) * r,
          y: rand(-200, 200),
          size: rand(0.7, 1.5),
          color: { r: 255, g: 255, b: 255 },
          twinkleOffset: Math.random() * 10
        });
      }
    }

    // åˆå§‹åŒ–é›ªèŠ±
    function createSnow() {
      snows.length = 0;
      for (let i = 0; i < SNOW_COUNT; i++) {
        const layer = Math.random(); // 0~1ï¼šè¶Šå¤§è¶Šâ€œè¿‘â€ï¼Œå°±æ›´å¤§æ›´äº®
        snows.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height - canvas.height,
          r: rand(5.0, 10.2) * (1.0 + layer * 2),          // é›ªèŠ±åŠå¾„èŒƒå›´
          vy: rand(0.4, 0.6) * (1.0 + layer * 0.5),        // ä¸‹è½é€Ÿåº¦
          sway: rand(0.4, 1.3) * (0.5 + layer),            // å·¦å³æ‘‡æ‘†å¹…åº¦
          phase: Math.random() * Math.PI * 2,
          alpha: rand(0.35, 0.95) * (0.5 + layer * 0.7)    // é›ªèŠ±é€æ˜åº¦
        });
      }
    }

    createScene();
    createSnow();

    // ç®€å• 3D æŠ•å½±
    function project3D(x, y, z) {
      const c = Math.cos(angle), s = Math.sin(angle);
      const xx = x * c - z * s;
      const zz = x * s + z * c;

      // åŠ ä¿¯ä»°è§’ï¼Œé…åˆé¼ æ ‡ä¸Šä¸‹åŠ¨
      const ty = y * Math.cos(cameraTilt) - zz * Math.sin(cameraTilt);
      const tz = y * Math.sin(cameraTilt) + zz * Math.cos(cameraTilt);

      const distance = 900;                       // ç›¸æœºåˆ°åœºæ™¯çš„â€œè·ç¦»â€
      const scale = distance / (distance + tz);   // æ¨¡æ‹Ÿé€è§†ç¼©æ”¾

      return {
        x: center.x + xx * scale,
        y: center.y - ty * scale,
        scale
      };
    }

    function draw(time) {
      // ç›¸æœºä¿¯ä»°åšä¸ªç¼“åŠ¨ï¼Œé¿å…ç”»é¢æŠ–
      cameraTilt += (cameraTiltTarget - cameraTilt) * 0.05;

      // æ ‘çš„è‡ªåŠ¨æ—‹è½¬é€Ÿåº¦
      baseAngle += 0.003;//è¶Šå¤§è½¬å¾—è¶Šå¿«
      angle = baseAngle;

      requestAnimationFrame(draw);
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      
      if (globalProgress < 1) {
        globalProgress = Math.min(1, globalProgress + 0.003);// æ ‘ä»ä¸‹å¾€ä¸Šé•¿å‡ºæ¥çš„é€Ÿåº¦
      } else {
        ribbonAppear = Math.min(1, ribbonAppear + 0.02); // å½©å¸¦å‡ºç°é€Ÿåº¦
      }

      // æ ‘ + åœ°é¢ + æ˜Ÿç©º
      for (const p of particles) {
        let px, py, pz, size, color;
        let alphaFactor = 1;

        if (p.type === "tree") {
          let tLocal = (globalProgress - p.delay) / p.duration;
          tLocal = Math.max(0, Math.min(1, tLocal));
          tLocal = easeOutCubic(tLocal);

          px = p.sx + (p.tx - p.sx) * tLocal;
          py = p.sy + (p.ty - p.sy) * tLocal;
          pz = p.sz + (p.tz - p.sz) * tLocal;

          size = p.size;
          color = p.baseColor;

          if (ribbonAppear > 0 && p.ribbonLayer >= 0) {
            const cfg = spiralConfigs[p.ribbonLayer];
            const t = 0.05 + 5 * p.h;
            const h = t;
            const y = h * TREE_HEIGHT;
            const radius = (1 - h) * BASE_RADIUS + 12;
            const th =
              h * cfg.turns * Math.PI * 2 +
              cfg.phase +
              time * 0.0008; // å½©å¸¦æ²¿ç€æ ‘ç»•åŠ¨çš„é€Ÿåº¦

            px = Math.cos(th) * radius;
            py = y;
            pz = Math.sin(th) * radius;

            color = cfg.color;
            size = p.size * (0.7 + 0.3 * ribbonAppear);
            alphaFactor = 0.9 + 0.9 * ribbonAppear;
          }
        } else {
          px = p.x;
          py = p.y;
          pz = p.z;
          size = p.size;
          color = p.color;
          if (p.type === "sky") alphaFactor = 0.55;
          if (p.type === "ring") alphaFactor = 0.8;
        }

        const proj = project3D(px, py, pz);
        const twinkle =
          0.4 + 0.6 * Math.abs(Math.sin(time * 0.005 + (p.twinkleOffset || 0) * 3));
        const alpha = 0.8 * twinkle * alphaFactor;
        const rSize = size * proj.scale * 1.5;

        ctx.beginPath();
        ctx.fillStyle = `rgba(${color.r},${color.g},${color.b},${alpha})`;
        ctx.arc(proj.x, proj.y, rSize, 0, Math.PI * 2);
        ctx.fill();
      }

      // é›ª:æœ€ä¸Šå±‚
      for (const s of snows) {
        s.y += s.vy;
        s.x += Math.sin(time * 0.0008 + s.phase) * s.sway;

        if (s.y > canvas.height + 40) {
          s.y = -200;
          s.x = Math.random() * canvas.width;
        }
        if (s.x < -10) s.x = canvas.width + 10;
        if (s.x > canvas.width + 10) s.x = -10;

        ctx.beginPath();
        ctx.fillStyle = `rgba(255, 255, 255, ${s.alpha})`;
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    requestAnimationFrame(draw);
  </script>
</body>
</html>
